# OSI 7계층

#### 개념

​	컴퓨터 네트워크 프로토콜 디자인과 통신을 계층으로 나누어 설명한것

#### 목적

​	프로토콜을 기능별로 나눈 것이다.
​	각 계층은 하위 계층의 기능만 이용하고 상위 계층에게 제공한다.
​	프로토콜 시스템은 이러한 계층들로 구성된다
​	프로토콜 스택은 하드웨어나 소프트웨어 혹은 둘의 혼합으로 구현될 수 있다.
​	프로토콜 스택 : 프로토콜 시스템이 구현된 시스템을 가리킨다.

#### OSI 7계층을 나눈 이유

​	통신이 일어나는 과정을 단계별로 파악할 수 있기 때문이다.
​	즉, 7단계 중 특정한 곳에 이상이 생기면 다른 단계의 장비 및 소프트웨어를 건들이지 않고도 이상 이 생긴 단계만
   고칠 수 있기 때문이다.



#### 계층

#### 1. 1계층 - 물리 계층

- 네트워크의 기본 네트워크 하드웨어 전송 기술을 이룬다.
- 네트워크의 높은 수준의 기능의 논리 데이터 구조를 기초로하는 필수 계층
- 다양한 특징의 하드웨어 기술이 접목되어 있기에 OSI 아키텍쳐에서 가장 복잡한 계층으로 간주된다.
- 이 계층에서 사용되는 통신 단위는 비트이며 이것은 1과 0으로 나타내어지는, 즉 전기적으로  On, Off 상태라고 생각하면 된다.
- 이 계층 에서는 단지 데이터를 전달만 할뿐 전송하려는(또는 받으려는) 데이터가 무엇인지, 어떤 에러가 있는지 등에 전혀 신경을 쓰지 않는다.
- 단지 데이터를 전기적인 신호로 변환해서 주고받는 기능만 할 뿐이다. 이 계층에 속하는 대표적인 장비는 통신 케이블, 리피터, 허브등이 있다.



리피터 :  전자기 또는 광학 전송매체 상에서 신호를 수신하고, 증폭하며, 매체의 다음 구간으로 재전송 시키는 장치

허브 :  Half-Duplex(반이중)로 동작한다 Hub에는 따로 운영체제가 존재하지 않기 때문에 유입되는 전기 신호를 구별하여 전달하지 못하여 신호가 들어온 포트를 제외한 나머지 모든 포트로 전달하는 Flooding을 한다. 이런 Hub의 특성 때ㅐ문에 전달되는 데이터의 순서가 따로 없고, 신호를 증폭하여 전달하는 과정에서 여러 신호들이 부딪히는 Collision(충돌)이 발생할 수 있다. 그렇기 때문에 데이터를 받는 Rx에서 전기 신호를 감지하면 Tx로 신호가 나가지 않도록 일시적으로 차단하고 이로인해 Hub는 송신과 수신을 동시에 하지 못하는 Half-Duplex로 통신하게 된다.



#### 2.  2계층 - 데이터 링크 계층

데이터 링크 계층의 2가지 특징

1. 프레임에 주소부여 (MAC - 물리적 주소)
2.  에러검출/ 재전송/ 흐름제어



**LAN (Local Area Network)** :  지역 네트워크로 학교, 회사, 집에서 컴퓨터 IP 전화기등의 장비를 서로 연걸한 것이다. 이때 컴퓨터끼리 1대1로 직접 연결하는게 아니라 공유기나 스위치등을 이용해서 연결한다.

**WAN (Wide Area Network)**:  LAN과 LAN 사이를 광범위한 지역 단위로 구성하는 네트워크이다. 예를 들어 본인 집에서 네이버를 접속한다고 치면 ISP(Internet Service Provider (SK, KT, LG)) 네트워크망을 통해 접속한다.



데이터 링크 계층은 WAN에서 인접한 노드끼리 또는 같은 LAN 강의 노드끼리 연결하여 데이터를 전달하는 계층이다.

같은 네트워크 상에서 발생되는 Frame을 전달하며 서로 다른 네트워크로 데이터를 전달하는 라우팅기술은 더 높은 계층의 기능이므로 서로 다른 네트워크로는 전달할 수 없다.

1계층에서 어떤 Media를 사용하고 있느냐에 따라 서로 다른 Protocol로 동작할 수 있으며 이것을 2계층(데이터 링크)에서 구분하여 결정한다.

또한 해당 Protocol에서 사용하는 물리적 주소를 구분하여 목적지로 전달해주는 역할을 하고있다.

LAN에서는 주로 Ethernet을 사용하고, Point-to-Point 구간에서는 PPP, HDLC 등을 사용한다.



- **네트워크별 통신 방식**

BMA (Broadcast Multiple Access)

 Broadcast (단일 노드로부터 해당 네트워크의 모든 노드에게 패킷/프레임 등을 전하는 것)가 전달되는 다중 접속 환경을 말하며, 일반적으로 LAN 구간이 여기에 해당된다. Broadcast란 동일한 네트워크에 연결된 모든 장비에게 전달하는 메시지 타입을 말한다. 여기서 사용되는 프로토콜로는 Ethernet, Token-ring, FDDI 등이 있으며, Ethernet이 주로 사용되고있다. Ethernet에서 사용하는 물리적 주소를 MAC주소라고 부르며 이 주소가 2계층의 물리적주소로 많이 표현되고 있다.

NBMA (Non-Broadcast Multi-Access)

 Broadcast 가 전달되지 않는 다중 접속 환경을 말하며, WAN 통신구간이 여기에 해당된다. WAN 구간은 많은 네트워크가 연결된 다중 접속 환경이기 때문에 Broadcast 가 되면 너무 많은 Broadcast 메시지로 인해 장비의 부하를 주며 성능저하를 가져오게 된다. 따라서 Broadcast 는 하나의 네트워크 안에서만 사용할 수 있도록 기본적으로 설정되어 있다. 이 방식에서 주로 사용하는 프로토콜은 Frame-relay가 있다.

Point-to-Point

점대점 연결을 말하며 중간에 다른 장비가 연결되지 않고 케이블이 End-to-End로 직접 연결된 환경을 말한다. 이 방식에서 사용하는 프로토콜로는 PPP, HDLC 등이 있으며, 장비를 2계층에서 구분할 필요가 없기 때문에 물리적 주소가 필요 없다는 특징이 있다.



- **이더넷**

LAN 환경에서 사용하는 대표적 프로토콜이다. 데이터 통신 발생 시 즉시 데이터링크에 접근하여 통신을 시도하는 랜덤 액세스 방식으로 동작하며, 구축 및 유지보수가 간편하여 비용이 저렴한 편이다. 다만 회선을 공유하는 다중 접속 환경에서 다른 장비의 통신 데이터와 충돌(Collision)하는 문제가 발생하여 대규모 네트워크로 구축하기엔 어렵다. 충돌을 최소화하기 위해 데이터링크에서는 매체접근제어(MAC)를 위해 CSMA/CD 기능을 사용한다.

 

- **매체접근제어**

CSMA/CD 방식 : 유선 LAN 중 반이중 방식의 이더넷(Ethernet)에서, 각 단말이 신호 전송을 위해 전송 공유매체에 규칙있게 접근하기 위한, 매체 엑세스 제어 방식

케이블이 사용중인지 확인하고 트래픽이 없으면 패킷을 송출하는 LAN의 매체 점유 방법 중 한가지 방법



- **장비 (Switch)**

Switch 이상의? 장비들은 데이터를 전달하는 과정에서 Collision이 발생되지 않기 때문에 송신과 수신을 동시에 할 수 있는 Full-Duplex로 동작한다. Switch에서 Collision이 발생되지 않는 이유는 다음과 같다.  

**1)** Switch는 주소학습 기능을 가진다.

어떤 MAC 주소가 어느 포트에 연결되어 있는지 헤더 안의 출발지 주소를 학습하여 저장하고 이를 통해 전달해야 하는 데이터의 목적지가 어느 포트에 연결되어 있는지 MAC-address Table 에서 확인하여 특정 포트로만 전달이 가능하다.

특정 포트끼리 통신을 하게 되면 다른 포트에 영향을 주지 않아서 장비들은 송수신을 동시에 할 수 있게 된다

**2)** Buffer를 사용하여 데이터 전달을 순차적으로 처리한다

Switch는 먼저 전송되고 있는 Frame이 목적지 포트로 모두 빠져나가는 동안 Buffer 라는 임시기억저장소를 이용하여 그 뒤로 들어온 Frame을 저장해두고 순차적으로 처리될 수 있도록 하고 있다.

따라서 만약 여러 장비가 어떤 특정 장비 하나와 통신을 하고자 Frame을 보내게 되도 Buffering 기능으로 인해 충돌이 발생되지 않는 것이다. 



- 물리 계층을 통해 송수신되는 정보의 오류와 흐름을 관리하여 안전한 정보의 전달을 수행할 수 있도록 도와주는 역할을 한다. (point to point 간 신뢰성 있는 전송을 보장하기 위한 계층)

- CRC (cyclical redundancy check : 순환 중복 검사) 기반의 오류제어와 흐름제어가 필요하다.

- 네트워크 위의 개체들 간 데이터를 전달하고, 물리 계층에서 발생할 수 있는 오류를 찾아 내고, 수정하는데 필요한 기능적 절차적 수단을 제공함

- 주소값을 물리적으로 할당받는데, 이는 네트워크 카드가 만들어 질 때 부터 **맥 주소**(MAC address)가 정해져 있다는 뜻이다.

- 이 계층에서 전송되는 단위를 프레임이라 하며, 대표적인 장비로는 브리지, 스위치 등이 있다. (브리지나 스위치를 통해 맥주소를 가지고 물리계층에서 받은 정보를 전달함)

- 주소체계는 없는 단일 구조이다.

- 데이터 링크 계층의 가장 잘 알려진 예는 이더넷이다. 이외에도 HDLC나 APCCP 같은 point to point 프로토콜이나 패킷스위칭 네트워크나 LLC, ALOHA 같은 근거리 네트워크 프로토콜이 있다.

  

#### 3. 3계층 - 네트워크 계층

논리적 주소를 기반으로 전송결로를 결정해준다.

3계층 Header의 내용을 수행하고 Network라는 계층의 이름처럼 전체 네트워크에서 나뉘어진 네트워크들을 구분해주고, 목적지로 데이터를 전달하기 위해 네트워크를 찾아주는 역할을 수행하는 계층이다.

- 논리적 주소

  **네트워크를 구성하는 목적과 규모에 따라 다양한 데이터링크 프로토콜이 사용된다. 각 프로토콜 간에 직접적인 통신은 안되기 때문에** 서로 다른 네트워크에 있는 장비와 연결을 위해선 공통적인 상위 프로토콜이 필요하다. 이를 위해 사용되는 논리적 주소 프로토콜로 IP, IPX, Apple-talk 등 다양한 프로토콜이 있으며, 현재 특정 어플리케이션 통신 외 일반적인 통신에서는 IP만 사용한다.

라우터부터 라우터까지의 경로설정

IP주소 : Net-ID 와 Host-ID 로 구성된다.

라우터

라우터는 네트워크 경계선에서 사용되는 장비로 다양한 데이터링크 네트워크를 연결할 수 있다. 각 인터페이스가 모두 다른 서브넷(subnet)으로 설정되며, IP를 설정하고 활성화 하면 자동으로 라우팅 테이블에 Connected 정보가 학습된다. 라우팅 기능 외에 ACL, NAT 등 다양한 기능을 제공한다. 



- 이 계층에서 가장 중요한 기능은 데이터를 목적지 까지 가장 안전하고 빠르게 전달하는 기능(라우팅)이다.

- 여러개의 노드를 거칠 때 마다 경로를 찾아주고 경로에 따라 패킷을 전달해주는 역할을 하는 계층이다.

- 이 과정에서 전송 계층(4계층)이 요구하는 서비스 품질(QoS)을 제공하기 위한 기능적, 절차적 수단을 제공한다.

- 데이터를 연결하는 다른 네트워크를 통해 전달함으로써 인터넷이 가능하게 만드는 계층

- 논리적인 주소 구조(IP), 곧 네트워크 관리자가 직접 주소를 할당하는 구조를 가지며, 계층적(hierarchical)이다.

- 서브네트의 최상위 계층으로 경로를 설정하고, 청구 정보를 관리한다. 개방형 시스템들의 사이에서 네트워크 연결을 설정, 유지, 해제하는 기능을 부여하고, 전송 계층 사이에 네트워크 서비스 데이터 유닛(NSDU : Network Service Data Unit)을 교환하는 기능을 제공한다.

  

3-2. IP 계층

 - TCP/IP 상에서 IP 계층이란 네트워크의 주소(IP 주소)를 정의하고, IP 패킷의 전달 및 라우팅을 담당하는 계층

 - OSI 7계층 모델의 관점에서 보면 IP 계층은 네트워크 계층에 해당한다. 즉, 패킷을 목적지 까지 전달하는 역할 및 그에 수반되는 기타 역할을 함

 - IP 계층의 주요 역할은 하위계층인 데이터링크 계층의 하드웨어적인 특성에(즉, ATM 이든 Frame Relay 든 상관없이) 관계없이 독립적인 역할을 수행

 - IP 계층 상에 있는 주요 프로토콜

   * 패킷의 전달을 책임 지는 IP

   * 패킷 전달 에러의 보고 및 진단을 위한 ICMP

   * 복잡한 네트워크에서 인터네트워킹을 위한 경로를 찾게해주는 라우팅 프로토콜 

     

3-3. IP 프로토콜

- TCP/IP 기반의 인터넷 말을 통하여 데이터그램의 전달을 담당하는 프로토콜

- 주요 기능

  IP 계층에서 IP 패킷의 라우팅 대상이 됨(Routing)

  IP 주소 지정(Addressing)

- 주요 특징

  - 신뢰성(에러제어)및 흐름제어 기능이 전혀 없음 -> Best-Effort-Service

    한편 신뢰성을 확보하려면 IP 계층 위의 TCP와 같은 상위 트랜스포트 계층에 의존

  - 비연결성 데이터그램 방식으로 전달되는 프로토콜 -> Connectionless
  - 패킷의 완전한 전달(소실, 중복, 지연, 순서바뀜 등이)을 보장 않음 -> Unreliable
  - IP 패킷 헤더 내 수신 및 발신 주소를 포함 -> IPv4 헤더, IPv6 헤더, IP 주소
  - IP 헤더 내 바이트 전달 순서 : 최상위 바이트(MSB)를 먼저 보냄 -> Big-endian
  - 경우에 따라 단편화가 필요함 -> IP 단편화
  - TCP, UDP, ICMP, IGMP 등이 IP 데이터그램에 실려 전송



#### 4. 4계층 - 전송 계층(Transport Layer)

전송 계층은 서비스를 구분하고 데이터 통신방식을 결정하는 계층이다. 

4계층은 데이터를 생성하는 상위계층과 데이터를 전달해주는 하위계층을 연결해주는 역할을 담당하고 있다. 상위계층의 서비스들을 구분하여 정확하게 서비스를 제공받을 수 있도록 도와주며, 데이터의 성격에 따라 통신방식을 달리하여 효율적으로 통신될 수 있도록 의사결정을 해준다.



- 통신을 활성화하기 위한 계층이다. 보통 TCP 프로토콜을 이용하며, 포트를 열어서 응용프로그램들이 전송을 할 수 있게 한다.

- 만약 데이터가 왔다면 4계층에서 해당 데이터를 하나로 합쳐서 5계층에 전달한다.

- end to end 오류제어 및 흐름제어 이 계층 까지는 물리적인 계층에 속한다. (TCP/UDP 프로토콜을 사용한다)

- 양 끝단(End to End)의 사용자들이 신뢰성있는 데이터를 주고 받을 수 있도록 해 주어, 상위 계층들이 데이터 전달의 유효성이나 효율성을 생각하지 않도록 해준다.

- 시퀀스 넘버 기반의 오류제어 방식을 사용한다.

- 전송 계층은 특정 연결의 유효성을 제어하고, 일부 프로토콜은 상태 개념이 있고,

- 연결 기반(connection oriented)이다. - 이는 전송 계층이 패킷들의 전송이 유효한지 확인하고 전송 실패한 패킷들을 다시 전송한다는 것을 뜻한다. - 가장 잘 알려진 전송계층의 예는 TCP 이다.

- end-to-end 통신을 다루는 최하위 계층으로 종단간 신뢰성 있고 효율적인 데이터를 전송하며, 기능은 오류검출 및 복구와 흐름제어, 중복검사 등을 수행한다.

  

4-2. TCP 프로토콜 (Transmission Control Protocol)

- OSI 계층 모델의 관점에서 전송계층에 해당
- 양종단 호스트 내 프로세스 상호간에 신뢰적인 연결지향성 서비스를 제공
- IP의 비신뢰적인 최선형 서비스에다가 신뢰적인 연결 지향성 서비스를 제공하게됨
- **신뢰적인 전송을 보장**함으로써, 어플리케이션 구현이 한층 쉬워지게 됨

1.  Reliable(신뢰성 있음)

   패킷 손실, 중복, 순서 바뀜 등이 없도록 보장

   TCP 하위계층인 IP 계층의 신뢰성 없는 서비스에 대해 다방면으로 신뢰성을 제공

2.  Connection-oriented(연결 지향적)

   같은 전송계층의 UDP가 비연결성(connectionless)인 것과는 달리, TCP는 연결지향적 이다. 이 경우, 느슨한 연결(Loosly Connected)을 갖으므로 강한 연결을 의미하는 가상회선이라는 표현 보다는 오히려 연결지향적이라고 말한다.

   연결 관리를 위한 연결설정 및 연결해제 필요 -> TCP 연결성정, TCP 연결종료

   양단간 어플리케이션/프로세스는 TCP가 제공하는 연결성 회선을 통하여 서로 통신한다.

   

4-3. UDP 프로토콜 (User Datagram Protocol)

- 전송 계층의 통신 프로토콜의 하나(TCP에 대비됨)

  \- **신뢰성이 낮은 프로토콜**로써 완전성을 보증하지 않으나,

  \- 가상회선을 굳이 확립할 필요가 없고 유연하며 효율적 응용의 데이터 전송에 사용

1. **비연결성이고, 신뢰성이 없으며, 순서화되지 않은 Datagram 서비스 제공**

   \- 메세지가 제대로 도착했는지 확인하지 않음 (확인응답 없음)

   \- 수신된 메세지의 순서를 맞추지 않음 (순서제어 없음) 

   \- 흐름 제어를 위한 피드백을 제공하지 않음 (흐름제어 없음)

   \- 검사합(체크섬)을 제외한 특별한 오류 검출 및 제어 없음 (오류제어 거의 없음)

   UDP를 사용하는 프로그램 쪽에서 오류제어 기능을 스스로 갖추어야 함

   \- 데이터그램 지향의 전송계층용 프로토콜 (논리적인 가상회선 연결이 필요없음)

   비연결접속상태 하에서 통신 

2. 실기간 응용 및 멀티태스킹 가능

   \- 빠른 요청과 응답이 필요한 실기간 응용에 적합

   \- 여러 다수 지점에 전송 가능 (1 대 多)

3. 헤더가 단순함

   \- UDP는 TCP 처럼 16비트의 포트 번호를 사용하거나,

   \- 헤더는 고정크기의 8바이트(TCP는 20바이트)만 사용

   즉, 헤더처리에 많은 시간과 노력을 요구하지 않음



일반적으로 하위 계층(1~3)들은 운영체제 내부에서 구현되어 사용된다. 이에 비해 상위 세 계층(5~7)은 사용자 프로그램을 구현하는데 사용이 된다. 이에 대해 살펴볼 것이다.



#### 5. 5계층 - 세션 계층

세션 계층은 상위 계층에 제공하는 서비스로 세션 연결 설정과 해제, 세션 메시지 전송을 통해 동작한다. 

세션 계층은 크게 **동기 기능**과 **대화의 기능**을 수행한다. 통신 양단끼리 서로 동의하는 논리적인 공통 시점인 동기점을 만들어 메시지가 제대로 처리가 되고 있는지를 파악하게 된다. 

동기점은 오류 복구를 위하여 필수적으로 사용되는데 동기점 설정 이전까지는 서로 처리가 완료되었음을 합의하는 것을 의미한다. 동기점 이전 과정은 복구가 필요 없고 동기점 이후 처리 과정에 대한 복구 절차가 진행된다. 

대화는 데이터 전송 과정을 의미한다. 시간 경과에 따른 순차적으로 동기점을 부여하여 신뢰성 보장 기능을 단계적으로 구현할 수 있게 된다. 의도적으로 일시 정지하여 나중에 이어서 작업을 하는 것이 가능하다.



- **데이터가 통신하기 위한 논리적인 연결**을 말한다.

- 하지만 4계층에서도 연결을 맺고 종료할 수 있기 때문에 우리가 어느 계층에서 통신이 끊어 졌나 판단하기는 한계가 있다. 그러므로 세션 계층은 4계층과 무관하게 응용 프로그램 관점에서 봐야한다. -> 세션 설정, 유지, 종료, 전송 중단시 복구 등의 기능이 있다.

- 세션 계층은 양 끝단의 응용 프로세스가 통신을 관리하기 위한 방법을 제공한다.

  \- 동시 송수신 방식(duplex)

  \- 반이중 방식(half-duplex)

  \- 전이중 방식(Full Duplex)

  의 통신과 함께, 체크 포인팅과 유휴, 종료, 다시 시작 과정 등을 수행한다.

  이 계층은 TCP/IP 세션을 만들고 없애는 책임을 진다.

  -> 

  통신하는 사용사들을 동기화하고 오류복구 명령들을 일괄적으로 다룬다.

  통신을 하기 위한 세션을 확립/유지/중단 (운영체제가 해줌)



#### 6. 6계층 - 표현 계층 (Presentation Layer)

- 데이터 표현이 상이한 응용 프로세스의 독립성을 제공하고, 암호화 한다.

- 코드간의 번역을 담당하여 사용자 시스템에서 데이터의 형식상 차이를 다루는 부담을 응용 계층으로부터 덜어 준다. MIME 인코딩이나 암호화 등의 동작이 이 계층에서 이루어 진다.
- 예를 들면 , EBCDIC로 인코딩된 문서 파일을 ASCII로 인코딩된 파일로 바꿔 주는 것, 해당 데이터가 TEXT인지, 그림인지, GIF인지, JPG인지 구분 등이 표현 계층의 몫이다.

-> 사용자의 명령어를 완성및 결과 표현. 포장/압축/암호화



#### 7. 7계층 - 응용 계층(Application Layer)

- 응용 계층의 하부에 있는 계층들은 신뢰성 있는 데이터 전송을 보장하는 역할을 수행한다. 이에 비해 **응용 계층은 하부 계층들을 이용해 사용자에게 편리한 환경을 제공하는 것에 초점**을 둔다. 따라서 응용 계층의 구현은 사용자 프로그램 환경에서 이루어지며 운영체제에서 제공되는 4계층(전송 계층)의 인터페이스를 사용해 통신 기능을 구현한다. 필요에 따라 세션, 표현 계층의 기능을 포함한다.

- 사용자와 가장 밀접한 계층이며 인터페이스 역할을 한다.
- 실제로 통신의 최종 목적에 해당하는 계층
- 응용 계층에서는 헤더와 트레일러가 추가되지 않는다.

* 주요 역할

  응용 서비스를 네트워크에 접속시키는 역할을 한다.

  (파일 전송, 데이터베이스, 원격 접속, 이메일 전송 등)

* 프로토콜

  사용자와 가장 가까운 프로토콜을 정의한다.