# 해시(Hash)

### 해시함수

**해시 함수**는 임의의 길이를 갖는 임의의 데이터에 대해 고정된 길이의 데이터로 매핑하는 함수를 말한다.

**해시**란 키를 직접 조작하여 저장 주소를 찾는 방식이며, 이 방식에 의해 만들어진 사전을 해시테이블이라고 한다.

<br>

### 헤시테이블과 성능

헤시테이블은 키-주소 매핑에 의해 구현된 사전 ADT(Abstract Data Type)를 말한다.

<br>

해시테이블은 버켓 배열과 해시함수로 이루어진다.

**버켓배열** : 해시테이블을 구현한 1차원 배열

**해시함수** : 키-주소 매핑을 위한 연산을 수행하는 함수

<br>

### 해시함수

해시함수는 주어진 형의 키를 고정범위로 매핑한다.

ex)  h(x) = x % M

정수  h(x)를 x의 해시값(hash value)라고 부른다.

h : 해시함수

M : 크기 M의 배열(해시테이블)

고정 범위 [0, M-1]

<br>

### 해싱

즉 해시를 하는 해싱이란

h(x) = x / 100 이라는 해시 함수가 있으면

데이터 123, 200, 310 이 존재한다고 가정하면

해시 테이블에는 

 인덱스(key)   값(value)

​		1			123

​		2			200

​		3			310

이렇게 해싱이 된다.

<br>

그런데 이 상황에서 데이터에 123, 190, 200, 310 존재한다고 가정하면 인덱스 1 에는 출동이 발생할 것이다.<br>

출동 해결을 아래에서 알아보자

<br>

### 충돌 해결

충돌은 두 개 이상의 원소들이 동일한 셀로 매핑됨을 말한다.

M : 배열의 크기

m: 데이터의 수

일 때 M < m 이면 출돌이 필수적이다.

<br>

출돌 해결에는 2가지 방법이 있다.

#### 1. 분리 연쇄법 (separate chaning) 또는 연쇄법(Chaning)

즉, 동일한 주소로 해시되는 모든 원소가 리스트 형태로 연결되는 해싱 방법이다.

ex) 해싱할 데이터가 123, 190, 200, 310, 378 이 있고

해시함수 h(x) = x / 100 이라고 가정하면

해시테이블에는

인덱스	값

1			123	->	190

2			200

3			310	-> 	378

이렇게 해싱이 된다.

<br>

**장점** : 단순하고(항목의 삽입 삭제가 비교적 단순하고) 빠르다.

**단점** : 테이블 외부에 리스트를 위한 추가적인 저장공간이 필요하다.

<br>

#### 2. 개방 주소법 (open addressing)

개방주소법에서는 충돌 항목이 테이블의 다른셀에 저장된다.

개방주소법은 크게 3가지로 나뉜다.

<br>

#### 2 - 1. 선형조사법

선형조사법은 충돌 항목을 (원형으로) **바로 다음의 비어 있는 테이블 셀에 저장**함으로써 충돌을 처리한다.

이때 검사되는 각 테이블 셀을 조사(probe)라고 부른다. 

<br>

**단점** : 충돌 항목들이 무리짓게 되며 이후의 충돌에 의해 더욱 긴 조사열로 군집하는 경향이 있다는 것이다.

​		이를 1차 군집화라고 한다. 군집화(특정 주소들 주위로 뭉치는 현상)는 사전의 성능에 악영향을 끼친다. 

​		사전의 주요 작업 수행시 선형탐색 방식으로 군집을 지나가는데 많은 시간이 소요되기 때문이다.

<br>

#### 2 - 2. 2차 조사법(guadratic probing)

2차 조사법은 다음 순서에 의해 버켓을 조사한다.

즉, 	h(k),	h(k) + 1^2,	h(k) + 2^2,	h(k) + 3^2, ... 의 순서

2차 조사법을 사용하면 해시값이 동일한 키들은 동일한 조사를 수반한다.

이에 따라 선형조사법의 단점인 1차 군집화는 피하지만 다시 2차 군집화를 형성한다.

2차 군집화 역시 1차 군집화와 마찬가지 사전의 성능에 안 좋은 영향을 끼친다.

또한 **M(버켓의 크기)이 소수가 아니면 찾지 못할 수 있다.**

<br>

#### 2 - 3. 이중해싱(double hashing)

이중해싱은 두 번째의 해시함수 h' 을 사용하여 다음 순서에 의해 버켓을 조사한다.

즉,	h(k),	h(k) + h'(k),	h(k) + 2h'(k),	h(k) + 3h'(k), ... 의 순서

이중해싱을 사용하면 동일한 해시값을 가지는 키들도 상이한 조사를 수반할 수 있기 때문에 군집화를 최소화한다.

**이중해싱시 주의할 점은 h'의 계산결과가 0이 안되도록 설계해야한다.**



#### ★ 개방주소법에서의 갱신

만약에 개방주소법을 사용시

버켓의 항목이 삭제된 후 그 버켓을 단순 비어있는 것으로 설정하면 차후의 탐색 작업에서는 그 버켓을 검사한 후  다음 버켓으로 진행하기를 멈출 것이다. (왜??)

따라서 조사 순서상 그 버켓 이후에 존재하는 항목들에 대한 탐색은 모두 실패하게 된다. 그렇다고 해서 삭제된 항목을 그대로 놔둘 수는 없는 일이다.

<br>

이를 해결하기 위한 방법은

삭제된 원소를 비어있는 셀로 설정하는 것이아니라 **Available** 이라는 특별한 원소로 대체하여 해당 셀을 **비활성화** 시키는 것이다. 

즉, **탐색 작업 수행중** Available을 원소로 가진 버켓을 만나면 실제 원소가 있는 버켓처럼 취급하여 탐색을 계속 진행하라는 뜻으로 해석한다.

하지만 **삽입작업 수행중** Available을 원소로 가진 버켓을 만나면 비어 있는 버켓으로 취급하여 이 버켓에 삽입한다.